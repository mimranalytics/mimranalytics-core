services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: "${POSTGRES_USER}"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
      POSTGRES_DB: "${POSTGRES_DB}"
    ports: ["5432:5432"]
    volumes: ["pgdata:/var/lib/postgresql/data"]

  neo4j:
    image: neo4j:5
    environment:
      NEO4J_AUTH: "${NEO4J_AUTH}"
    ports: ["7474:7474","7687:7687"]
    volumes: ["neo:/data"]

  api:
    build: ./api
    environment:
      PG_URL: "postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}"
      NEO4J_URL: "bolt://neo4j:7687"
      NEO4J_USER: "${NEO4J_USER}"
      NEO4J_PASS: "${NEO4J_PASS}"
    depends_on: [postgres, neo4j]
    ports: ["${API_PORT:-8000}:8000"]

  frontend:
    build: ./frontend
    depends_on: [api]
    ports: ["${FRONTEND_PORT:-3000}:80"]

  seeder:
    build: ./seeder
    environment:
      PG_URL: "postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5432/${POSTGRES_DB}"
      NEO4J_URL: "bolt://neo4j:7687"
      NEO4J_USER: "${NEO4J_USER}"
      NEO4J_PASS: "${NEO4J_PASS}"
    depends_on: [postgres, neo4j]

volumes:
  pgdata: {}
  neo: {}
